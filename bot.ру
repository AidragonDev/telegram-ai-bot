import os
import logging
from telegram import Update
from telegram.ext import Application, CommandHandler, MessageHandler, filters, ContextTypes

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
logging.basicConfig(level=logging.INFO)
logger = logging.getLogger(__name__)

BOT_TOKEN = os.environ.get("BOT_TOKEN")

async def start(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """–ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ"""
    await update.message.reply_text(
        "ü§ñ **–ü—Ä–∏–≤–µ—Ç! –Ø Aidragon - —Ç–≤–æ–π AI-–ø–æ–º–æ—â–Ω–∏–∫!**\n\n"
        "–Ø —Å–æ–∑–¥–∞–Ω –Ω–∞ –æ—Å–Ω–æ–≤–µ –Ω–µ–π—Ä–æ—Å–µ—Ç–∏ Yandex GPT –∏ –≥–æ—Ç–æ–≤ –ø–æ–º–æ—á—å:\n"
        "‚Ä¢ –û—Ç–≤–µ—Ç–∏—Ç—å –Ω–∞ –ª—é–±–æ–π –≤–æ–ø—Ä–æ—Å\n‚Ä¢ –ü–æ–º–æ—á—å —Å –∑–∞–¥–∞—á–∞–º–∏\n‚Ä¢ –ü–æ–¥–¥–µ—Ä–∂–∞—Ç—å –±–µ—Å–µ–¥—É\n"
        "‚Ä¢ –ò –º–Ω–æ–≥–æ–µ –¥—Ä—É–≥–æ–µ!\n\n"
        "**–ü—Ä–æ—Å—Ç–æ –Ω–∞–ø–∏—à–∏ –º–Ω–µ —Å–æ–æ–±—â–µ–Ω–∏–µ - –∏ —è –æ—Ç–≤–µ—á—É!** üí´\n\n"
        "_‚ö° –†–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ Yandex GPT —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏_"
    )

async def help_command(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """–ü–æ–º–æ—â—å"""
    await update.message.reply_text(
        "üìã **–ö–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –±–æ—Ç–æ–º:**\n\n"
        "‚Ä¢ –ü—Ä–æ—Å—Ç–æ –Ω–∞–ø–∏—à–∏ –ª—é–±–æ–π –≤–æ–ø—Ä–æ—Å –∏–ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ\n"
        "‚Ä¢ –Ø –æ—Ç–≤–µ—á—É –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ\n"
        "‚Ä¢ –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é –ª—é–±—ã–µ —Ç–µ–º—ã\n\n"
        "**–ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤:**\n"
        "‚Ä¢ '–†–∞—Å—Å–∫–∞–∂–∏ –æ –∫–æ—Å–º–æ—Å–µ'\n"
        "‚Ä¢ '–ü–æ–º–æ–≥–∏ —Å –¥–æ–º–∞—à–∫–æ–π'\n" 
        "‚Ä¢ '–ù–∞–ø–∏—à–∏ —Å—Ç–∏—Ö–æ—Ç–≤–æ—Ä–µ–Ω–∏–µ'\n"
        "‚Ä¢ '–û–±—ä—è—Å–Ω–∏ –∫–≤–∞–Ω—Ç–æ–≤—É—é —Ñ–∏–∑–∏–∫—É'"
    )

async def handle_message(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """–û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π —Å –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ–º"""
    user_message = update.message.text
    
    # –û—Ç–≤–µ—Ç—ã –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ —Å–æ–æ–±—â–µ–Ω–∏–π
    responses = {
        "–ø—Ä–∏–≤–µ—Ç": "–ü—Ä–∏–≤–µ—Ç-–ø—Ä–∏–≤–µ—Ç! üéâ –ö–∞–∫ —Ç–≤–æ–∏ –¥–µ–ª–∞?",
        "–∫–∞–∫ –¥–µ–ª–∞": "–£ –º–µ–Ω—è –æ—Ç–ª–∏—á–Ω–æ! –ì–æ—Ç–æ–≤ –ø–æ–º–æ–≥–∞—Ç—å —Ç–µ–±–µ! üòä",
        "—á—Ç–æ —Ç—ã —É–º–µ–µ—à—å": "–û—Ç–≤–µ—á–∞—Ç—å –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã, –ø–æ–º–æ–≥–∞—Ç—å —Å —É—á–µ–±–æ–π, –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∏–¥–µ–∏ –∏ –ø—Ä–æ—Å—Ç–æ –æ–±—â–∞—Ç—å—Å—è!",
        "—Å–ø–∞—Å–∏–±–æ": "–í—Å–µ–≥–¥–∞ —Ä–∞–¥ –ø–æ–º–æ—á—å! üí´",
    }
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –µ—Å—Ç—å –ª–∏ –≥–æ—Ç–æ–≤—ã–π –æ—Ç–≤–µ—Ç
    message_lower = user_message.lower()
    for key in responses:
        if key in message_lower:
            await update.message.reply_text(responses[key])
            return
    
    # –ï—Å–ª–∏ –Ω–µ—Ç –≥–æ—Ç–æ–≤–æ–≥–æ –æ—Ç–≤–µ—Ç–∞ - –¥–∞–µ–º –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é
    await update.message.reply_text(
        f"üîπ **–í–∞—à –∑–∞–ø—Ä–æ—Å:** _{user_message}_\n\n"
        f"ü§ñ **–î–ª—è AI-–æ—Ç–≤–µ—Ç–∞ –ø–µ—Ä–µ–π–¥–∏ –≤:** @YandexGPTBot\n\n"
        f"üí° **–ò–ª–∏ –∑–∞–¥–∞–π –≤–æ–ø—Ä–æ—Å –∑–¥–µ—Å—å, –∏ —è –ø–æ–º–æ–≥—É —Å –æ—Ç–≤–µ—Ç–æ–º!**\n\n"
        f"_‚ö° Yandex GPT –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –ª—É—á—à–∏–µ –æ—Ç–≤–µ—Ç—ã –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ_"
    )

def main():
    """–ó–∞–ø—É—Å–∫ –±–æ—Ç–∞"""
    if not BOT_TOKEN:
        logger.error("‚ùå BOT_TOKEN –Ω–µ –Ω–∞–π–¥–µ–Ω!")
        return
    
    try:
        application = Application.builder().token(BOT_TOKEN).build()
        
        # –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
        application.add_handler(CommandHandler("start", start))
        application.add_handler(CommandHandler("help", help_command))
        application.add_handler(MessageHandler(filters.TEXT & ~filters.COMMAND, handle_message))
        
        logger.info("üü¢ Aidragon Bot –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è...")
        application.run_polling(drop_pending_updates=True)
        
    except Exception as e:
        logger.error(f"‚ùå –û—à–∏–±–∫–∞: {e}")

if __name__ == "__main__":
    main()
